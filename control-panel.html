<!DOCTYPE html>
<html lang="ru">
<head>
    <link rel="icon" href="favicon.png" type="image/x-icon">
    <link rel="shortcut icon" href="favicon.png" type="image/x-icon">
    <title>Control Panel v2.0</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="style.css">
    <script src="Javascripts/control-panel.js" defer></script>
</head>
<body>
    <!-- Индикатор соединения -->
    <div id="connectionIndicator" class="connection-indicator connecting">Подключение...</div>
    
    <!-- Сообщения об ошибках -->
    <div id="errorMessage" class="error-message"></div>
    <div id="successMessage" class="success-message"></div>
    
    <!-- Контейнер для фона -->
    <div class="background-container" id="backgroundContainer">
        <img id="backgroundImage" src="" alt="Фон" style="display: none;">
    </div>
    <!-- Хит-слой для перетаскивания фона -->
    <div id="backgroundHitLayer" style="
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 5; /* Между фоном и UI */
        pointer-events: none; /* По умолчанию — не мешает */
        display: none;
    "></div>
    <div class="container">
        <div class="score-display">
            <div class="team">
                <h2>Команда 1</h2>
                <span id="team1Score">0</span>
                <div>
                    <button onclick="sendCommand('add_goal', {team: 1})" aria-label="Добавить гол команде 1">Гол</button>
                    <button onclick="sendCommand('undo_goal', {team: 1})" aria-label="Отменить гол команде 1">Отмена</button>
                </div>
            </div>
            
            <div class="timer">
                <h2 id="timerDisplay">00:00</h2>
                <div id="halfIndicator">1 тайм</div>
            </div>
            
            <div class="team">
                <h2>Команда 2</h2>
                <span id="team2Score">0</span>
                <div>
                    <button onclick="sendCommand('add_goal', {team: 2})" aria-label="Добавить гол команде 2">Гол</button>
                    <button onclick="sendCommand('undo_goal', {team: 2})" aria-label="Отменить гол команде 2">Отмена</button>
                </div>
            </div>
        </div>

        <div class="controls">
            <button id="startHalf1" onclick="toggleHalf(1)" aria-label="Управление первым таймом">Старт 1 тайм</button>
            <button id="startHalf2" onclick="toggleHalf(2)" aria-label="Управление вторым таймом">Старт 2 тайм</button>
            <button onclick="sendCommand('reset', {half: currentHalf})" aria-label="Сбросить счёт">Сброс</button>
            <label>
                <input type="checkbox" id="autoStop" onchange="sendCommand('toggle_auto_stop')" aria-label="Автоматическая остановка таймера">
                Авто-стоп
            </label>
            <button id="muteBtn" onclick="sendCommand('toggle_mute')" aria-label="Переключить звук">Mute</button>
        </div>
        
        <div style="margin-top: 15px; display: flex; align-items: center; gap: 10px;">
            <label for="timeInput">Установить время:</label>
            <input type="text" id="timeInput" placeholder="ММ:СС" maxlength="5" 
                   style="width: 80px; padding: 8px; font-size: 1em;" 
                   aria-label="Время в формате ММ:СС">
            <button onclick="setCustomTime()" style="padding: 8px 12px;" aria-label="Применить установленное время">Применить</button>
        </div>

        <!-- Управление фоном -->
        <div class="background-controls">
            <h3>Управление фоном</h3>
            <input type="file" id="backgroundUpload" accept="image/*" aria-label="Выбрать файл изображения для фона">
            <button onclick="document.getElementById('backgroundUpload').click()">Выбрать фон</button>
            <button id="fixBackgroundBtn" onclick="toggleBackgroundFixed()">Зафиксировать фон</button>
            <div class="scale-controls">
                <button onclick="scaleBackground(1.1)" aria-label="Увеличить масштаб фона">+ Увеличить</button>
                <button onclick="scaleBackground(0.9)" aria-label="Уменьшить масштаб фона">- Уменьшить</button>
            </div>
        </div>

        <!-- Управление позицией фона -->
        <details class="background-position-controls" data-interactive style="margin-top: 15px; background: #f8f9fa; border-radius: 8px;">
            <summary style="padding: 10px; cursor: pointer; font-weight: bold;">Управление позицией фона</summary>
            <div style="padding: 15px; display: flex; flex-direction: column; gap: 15px;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <label>Шаг (px):</label>
                    <input type="number" id="bgStep" value="10" min="1" max="500" style="width: 60px;">
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; width: fit-content; margin: 0 auto;">
                    <div></div>
                    <button onclick="moveBackground(0, -1)" style="padding: 10px; font-size: 1.2em;">▲</button>
                    <div></div>
                    <button onclick="moveBackground(-1, 0)" style="padding: 10px; font-size: 1.2em;">◄</button>
                    <button onclick="resetBackgroundPosition()" style="padding: 10px; font-size: 0.9em;">Сброс</button>
                    <button onclick="moveBackground(1, 0)" style="padding: 10px; font-size: 1.2em;">►</button>
                    <div></div>
                    <button onclick="moveBackground(0, 1)" style="padding: 10px; font-size: 1.2em;">▼</button>
                    <div></div>
                </div>

                <div style="display: flex; align-items: center; gap: 10px; justify-content: center;">
                    <label>X:</label>
                    <input type="number" id="bgX" value="0" style="width: 80px;">
                    <label>Y:</label>
                    <input type="number" id="bgY" value="0" style="width: 80px;">
                    <button onclick="applyBackgroundPosition()" style="padding: 8px 12px;">Применить</button>
                </div>
            </div>
        </details>

        <!-- Настройка шрифтов -->
        <div class="font-controls" style="margin: 20px 0; padding: 20px; background: #e9ecef; border-radius: 10px;">
            <h3>Настройка шрифтов</h3>

            <div>
                <label for="scoreSize">Размер счёта: 
                    <input type="number" id="scoreSize" min="1" max="10" step="0.1" value="4" aria-label="Размер шрифта счёта">
                </label>
                <button onclick="updateFontSize('teamScore', 'scoreSize')">Применить</button>
            </div>

            <div style="margin-top: 10px;">
                <label for="timerSize">Размер таймера: 
                    <input type="number" id="timerSize" min="1" max="10" step="0.1" value="6" aria-label="Размер шрифта таймера">
                </label>
                <button onclick="updateFontSize('timer', 'timerSize')">Применить</button>
            </div>

            <div style="margin-top: 15px;">
                <label for="scoreFont">Шрифт счёта:</label>
                <select id="scoreFont" aria-label="Выбор шрифта для счёта"></select>
                <button onclick="updateFontFamily('teamScore', 'scoreFont')">Применить</button>
            </div>

            <div style="margin-top: 10px;">
                <label for="timerFont">Шрифт таймера:</label>
                <select id="timerFont" aria-label="Выбор шрифта для таймера"></select>
                <button onclick="updateFontFamily('timer', 'timerFont')">Применить</button>
            </div>
        </div>
    </div>
</body>
</html>